<!DOCTYPE html>
<div class="wrap small">© <span id="year"></span> Math Mentors Club · CC BY 4.0</div>
</footer>


<script>
// Flash message (from redirects)
const flash=document.getElementById('flash');
const qs=new URLSearchParams(location.search); const msg=qs.get('msg');
if(msg){ flash.textContent=decodeURIComponent(msg); flash.classList.remove('hidden'); history.replaceState({},'',location.pathname); }


// Account dropdown + Admin gating
const accountBtn=document.getElementById('accountBtn');
const accountMenu=document.getElementById('accountMenu');
const adminLink=document.getElementById('admin-link');
function closeMenu(){ accountMenu.style.display='none'; }
function toggleMenu(){ accountMenu.style.display=(accountMenu.style.display==='block'?'none':'block'); }
document.addEventListener('click',e=>{ if(!e.target.closest('.acct')) closeMenu(); });
accountBtn.addEventListener('click',e=>{ e.preventDefault(); toggleMenu(); });
async function usernameOf(user){ const {data}=await supabase.from('profiles').select('username').eq('id',user.id).maybeSingle(); return (data&&data.username)?data.username:(user.email||'Account'); }
async function isAdmin(uid){ try{ const {data}=await supabase.from('admins').select('user_id').eq('user_id',uid).maybeSingle(); return !!data; }catch{ return false; } }
async function setMenu(){
const { data:{ user } } = await supabase.auth.getUser();
if(user){
const uname=await usernameOf(user);
accountBtn.textContent=uname+" ▾"; accountBtn.style.fontSize='14px';
accountMenu.innerHTML=`<div class="head">Signed in as ${uname}</div>
<a href="settings.html">Settings</a>
<button id="logoutBtn" type="button">Log out</button>`;
document.getElementById('logoutBtn').onclick=async()=>{ await supabase.auth.signOut(); location.href='index.html?msg='+encodeURIComponent('Logged out.'); };
adminLink.classList.add('hidden'); if(await isAdmin(user.id)) adminLink.classList.remove('hidden');
} else {
accountBtn.textContent='Account ▾';
accountMenu.innerHTML=`<a href="login.html">Log in</a><a href="signup.html">Sign up</a>`;
adminLink.classList.add('hidden');
}
}
supabase.auth.onAuthStateChange(setMenu); setMenu();


// Featured resources (static samples → link to resources page)
const sample=[
{t:'Fractions Basics Pack', b:'Middle School', d:'10 scaffolded problems with solutions.'},
{t:'Intro to Probability', b:'Middle–High', d:'8 practice problems with full solutions.'},
{t:'Factoring Quadratics', b:'High School', d:'Examples, checks, and a one‑page reference.'}
];
const feat=document.getElementById('feat-grid');
sample.forEach(x=>{ const c=document.createElement('article'); c.className='card'; c.innerHTML=`<div class="kicker">${x.b}</div><h3 style="margin:6px 0 6px">${x.t}</h3><p class="small">${x.d}</p><a class="btn" href="resources.html">Open</a>`; feat.appendChild(c); });


document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
