<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Math Mentors Club</title>
  <meta name="description" content="Student-made math resources and mentoring from the Math Mentors Club." />
  <style>
    :root { --bg:#0b0c10; --card:#121318; --text:#e8e8f0; --muted:#a8adbd; --accent:#6ee7ff; --edge:#232636; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--text); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    header { position:sticky; top:0; backdrop-filter:saturate(180%) blur(10px); background:rgba(11,12,16,0.75); border-bottom:1px solid var(--edge); z-index:10; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 16px; }
    .nav { display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand { font-weight: 800; letter-spacing:0.3px; }
    .pill { display:inline-block; padding: 6px 12px; border:1px solid var(--edge); border-radius:999px; color:var(--text); cursor:pointer; }
    .pill:hover { background:#1a1f2b; }
    .dropdown-menu { display:none; position:absolute; right:0; top:100%; background:var(--card); border:1px solid var(--edge); border-radius:10px; margin-top:6px; min-width:160px; z-index:50; }
    .dropdown-menu a { display:block; padding:8px 12px; color:var(--text); text-decoration:none; }
    .dropdown-menu a:hover { background:#1a1f2b; }
    .dropdown.open .dropdown-menu { display:block; }
    footer { border-top:1px solid var(--edge); padding:20px 0 40px; color:var(--muted); }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">Math Mentors Club</div>
      <nav style="display:flex; gap:12px; position:relative;">
        <a class="pill" href="#resources">Resources</a>
        <a class="pill" href="about.html">About</a>
        <a class="pill" href="join.html">Join</a>

        <!-- Account Dropdown -->
        <div class="dropdown" id="account-dropdown">
          <div class="pill" id="account-btn">Account ▾</div>
          <div class="dropdown-menu" id="account-menu"></div>
        </div>

        <a class="pill hidden" id="admin-link" href="#admin">Admin</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Student-made math resources & mentoring</h1>
      <p>We create clear, friendly materials for younger learners and mentor students locally and online.</p>
    </section>

    <section id="resources" class="section">
      <h2>Resources</h2>
      <p class="small">PDF problem sets and study guides made by our members. Everything here is free to use.</p>
      <div id="resource-grid"></div>
    </section>

    <!-- Admin Panel -->
    <section id="admin" class="section hidden">
      <h2>Admin</h2>
      <div class="card">
        <table id="admin-table">
          <thead><tr><th>First</th><th>Last</th><th>Username</th><th>Email</th><th>Created</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap small">© <span id="year"></span> Math Mentors Club · CC BY 4.0</div>
  </footer>

<script>
  const supabase = window.supabase.createClient("https://xftcwjrnbphzbetbcnsw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhmdGN3anJuYnBoemJldGJjbnN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MzA4MTEsImV4cCI6MjA3MTQwNjgxMX0.PM4JJLgZ2aBs3QKSPS5rZshU01ZRavbbmVRjmSYSOPE");

  const accountBtn = document.getElementById('account-btn');
  const accountMenu = document.getElementById('account-menu');
  const accountDropdown = document.getElementById('account-dropdown');
  const adminLink = document.getElementById('admin-link');
  const adminSection = document.getElementById('admin');
  const adminTableBody = document.querySelector('#admin-table tbody');

  function toggleDropdown() {
    accountDropdown.classList.toggle('open');
  }
  accountBtn.addEventListener('click', toggleDropdown);
  document.addEventListener('click', e=>{
    if(!accountDropdown.contains(e.target)) accountDropdown.classList.remove('open');
  });

  function setMenuLoggedOut() {
    accountMenu.innerHTML = `
      <a href="login.html">Log In</a>
      <a href="signup.html">Sign Up</a>
    `;
  }
  function setMenuLoggedIn(user) {
    accountMenu.innerHTML = `
      <a href="profile.html">Profile</a>
      <a href="#" id="logout-link">Log Out</a>
    `;
    document.getElementById('logout-link').addEventListener('click', async e=>{
      e.preventDefault();
      await supabase.auth.signOut();
      setMenuLoggedOut();
      alert("Logged out.");
    });
  }

  async function checkAuth() {
    const { data: { user } } = await supabase.auth.getUser();
    if(user) {
      setMenuLoggedIn(user);
      if(user.email.endsWith("@example.com")) { // change to your admin email
        adminLink.classList.remove('hidden');
        adminSection.classList.remove('hidden');
        loadAdmin();
      }
    } else {
      setMenuLoggedOut();
    }
  }

  async function loadAdmin(){
    const { data, error } = await supabase.from('profiles').select('*').order('created_at',{ascending:false});
    adminTableBody.innerHTML = '';
    (data||[]).forEach(row=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${row.first_name||''}</td><td>${row.last_name||''}</td><td>${row.username||''}</td><td>${row.email||''}</td><td>${(row.created_at||'').slice(0,19).replace('T',' ')}</td>`;
      adminTableBody.appendChild(tr);
    });
  }

  supabase.auth.onAuthStateChange(checkAuth);
  checkAuth();
  document.getElementById('year').textContent=new Date().getFullYear();
</script>
</body>
</html>

